<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Resolver Cuestionario</title>
</head>

<body>
    <h2>Resolviendo: <span th:text="${intento.cuestionario.titulo}">TÃ­tulo</span></h2>

    <div id="temporizador" th:attr="data-tiempo=${tiempoDisponible}"></div>
    <p><strong>Tiempo restante:</strong> <span id="timer">--:--</span></p>

    <div style="border: 1px dashed #aaa; padding: 10px; margin: 20px 0;">
        <p>Pregunta [[${index + 1}]] de [[${total}]]</p>
    </div>

    <form th:action="@{/intentos/resolver/guardar}" method="post" id="form-respuesta">
        <input type="hidden" name="intentoId" th:value="${intento.id}" />
        <input type="hidden" name="preguntaId" th:value="${pregunta.id}" />
        <input type="hidden" name="index" th:value="${index}" />

        <fieldset style="margin-bottom: 20px;">
            <legend th:text="${pregunta.enunciado}">Texto de la pregunta</legend>

            <div th:each="respuesta : ${pregunta.respuestas}">
                <label>
                    <input type="radio" name="respuestaSeleccionadaId" th:value="${respuesta.id}" required />
                    <span th:text="${respuesta.texto}">Texto de la respuesta</span>
                </label><br />
            </div>
        </fieldset>

        <button type="submit" th:text="${index + 1 == total ? 'Finalizar intento' : 'Siguiente'}">Siguiente</button>
    </form>

    <script>
        window.onload = function () {
            const contenedor = document.getElementById("temporizador");
            let tiempo = parseInt(contenedor.dataset.tiempo);

            function countdown() {
                if (tiempo <= 0) {
                    document.getElementById("form-respuesta").submit();
                } else {
                    const min = Math.floor(tiempo / 60);
                    const sec = tiempo % 60;
                    document.getElementById("timer").innerText =
                        min + ":" + (sec < 10 ? "0" : "") + sec;
                    tiempo--;
                    setTimeout(countdown, 1000);
                }
            }

            countdown();
        };
    </script>
</body>
</html>
